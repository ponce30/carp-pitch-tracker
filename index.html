<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>CARP ç´…ç™½æˆ¦ æŠ•çƒè¨˜éŒ²</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Oswald:wght@500;700&display=swap');
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  :root{
    --red:#C4171C;--dk:#8B0000;--acc:#FF3333;
    --bg:#0A0A0A;--c1:#161616;--c2:#1E1E1E;
    --tx:#EEE;--dim:#777;
    --strike:#FFD700;--ball:#4488FF;--out:#FF3333;--green:#22CC66;--foul:#BB66FF;
    --iku:#D4A017;
  }
  body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;overflow:hidden;user-select:none;-webkit-user-select:none}

  .hd{background:linear-gradient(135deg,var(--dk),var(--red));padding:8px 16px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 12px rgba(196,23,28,.3)}
  .hd-t{font-family:Oswald,sans-serif;font-size:20px;font-weight:700;letter-spacing:2px;color:#fff}
  .hd-d{font-size:11px;color:rgba(255,255,255,.7)}

  .main{display:grid;grid-template-columns:240px 1fr 260px;gap:8px;padding:8px;height:calc(100vh - 44px)}

  .pnl{background:var(--c1);border-radius:10px;padding:8px;overflow-y:auto}
  .pnl-t{font-family:Oswald,sans-serif;font-size:11px;font-weight:700;color:var(--acc);margin-bottom:4px;letter-spacing:1px}
  .pnl-t2{font-size:10px;font-weight:700;color:var(--iku);margin:4px 0 3px;letter-spacing:1px}

  .pg{display:grid;grid-template-columns:1fr 1fr;gap:3px}
  .pb{
    background:var(--c2);border:2px solid transparent;border-radius:8px;
    padding:8px 3px;color:var(--tx);font-size:12px;font-weight:700;
    cursor:pointer;text-align:center;min-height:42px;
    display:flex;align-items:center;justify-content:center;gap:3px;
    transition:all .12s
  }
  .pb:active{transform:scale(.95)}
  .pb.sel{border-color:var(--acc);background:rgba(196,23,28,.2);color:#fff}
  .pb.iku{border-color:#555;color:#ccc}
  .pb.iku.sel{border-color:var(--iku);background:rgba(212,160,23,.15);color:var(--iku)}
  .pb .n{font-family:Oswald,sans-serif;font-size:10px;color:var(--dim);min-width:20px}

  .ctr{display:flex;flex-direction:column;gap:6px;overflow-y:auto}

  .st{background:var(--c1);border-radius:10px;padding:8px 12px;display:flex;align-items:center;justify-content:space-between}
  .st-r{font-size:9px;color:var(--dim);letter-spacing:1px;text-transform:uppercase}
  .st-n{font-size:16px;font-weight:900;color:#fff}
  .st-v{font-family:Oswald,sans-serif;font-size:14px;color:var(--acc);font-weight:700}

  .cnt{background:var(--c1);border-radius:10px;padding:8px 12px;display:flex;align-items:center;justify-content:center;gap:14px}
  .cnt-g{display:flex;align-items:center;gap:6px}
  .cnt-l{font-family:Oswald,sans-serif;font-size:13px;font-weight:700;width:14px}
  .cnt-l.bl{color:var(--ball)}.cnt-l.sl{color:var(--strike)}.cnt-l.ol{color:var(--out)}
  .cnt-d{display:flex;gap:5px}
  .dot{width:18px;height:18px;border-radius:50%;border:2px solid #444;transition:all .15s}
  .dot.ba{background:var(--ball);border-color:var(--ball);box-shadow:0 0 6px rgba(68,136,255,.5)}
  .dot.sa{background:var(--strike);border-color:var(--strike);box-shadow:0 0 6px rgba(255,215,0,.5)}
  .dot.oa{background:var(--out);border-color:var(--out);box-shadow:0 0 6px rgba(255,51,51,.5)}
  .cnt-stat{text-align:center}
  .cnt-num{font-family:Oswald,sans-serif;font-size:26px;font-weight:700;color:#fff;line-height:1}
  .cnt-lbl{font-size:9px;color:var(--dim);letter-spacing:1px}
  .cnt-mx{font-family:Oswald,sans-serif;font-size:22px;font-weight:700;color:var(--acc);line-height:1}
  .cnt-sp{font-family:Oswald,sans-serif;font-size:22px;font-weight:700;color:var(--green);line-height:1}

  .inp{background:var(--c1);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px}
  .irow{display:flex;gap:6px;align-items:center}
  .ilbl{font-size:11px;color:var(--dim);width:44px;flex-shrink:0;font-weight:700}
  .ilbl-opt{font-size:8px;color:#555;display:block}

  .bso-row{display:flex;gap:5px}
  .bso-b{
    flex:1;padding:14px 6px;border-radius:10px;border:2px solid #444;
    font-size:15px;font-weight:900;cursor:pointer;text-align:center;
    min-height:52px;transition:all .12s;display:flex;align-items:center;justify-content:center
  }
  .bso-b:active{transform:scale(.96)}
  .bso-b.str{color:var(--strike);background:var(--c2)}.bso-b.str.sel{background:rgba(255,215,0,.15);border-color:var(--strike)}
  .bso-b.bal{color:var(--ball);background:var(--c2)}.bso-b.bal.sel{background:rgba(68,136,255,.15);border-color:var(--ball)}
  .bso-b.fou{color:var(--foul);background:var(--c2)}.bso-b.fou.sel{background:rgba(187,102,255,.15);border-color:var(--foul)}

  .spd-wrap{display:flex;align-items:center;gap:6px;flex:1;flex-wrap:wrap}
  .spd-show{font-family:Oswald,sans-serif;font-size:28px;font-weight:700;color:#fff;min-width:80px}
  .spd-numpad{display:flex;gap:4px;flex-wrap:wrap}
  .spd-nb{
    background:var(--c2);border:2px solid #444;border-radius:8px;
    width:40px;height:40px;display:flex;align-items:center;justify-content:center;
    font-family:Oswald,sans-serif;font-size:18px;font-weight:700;color:#fff;
    cursor:pointer;transition:all .12s
  }
  .spd-nb:active{transform:scale(.92);background:#333}
  .spd-nb.cls{font-size:13px;color:var(--dim);width:40px}

  .pt-grid{display:flex;flex-wrap:wrap;gap:4px;flex:1}
  .pt-b{
    background:var(--c2);border:2px solid #444;border-radius:8px;
    padding:10px 10px;color:var(--tx);font-size:13px;font-weight:700;
    cursor:pointer;min-width:72px;text-align:center;min-height:44px;
    display:flex;align-items:center;justify-content:center;transition:all .12s
  }
  .pt-b:active{transform:scale(.95)}
  .pt-b.sel{border-color:var(--green);background:rgba(34,204,102,.12);color:var(--green)}

  .rs-grid{display:flex;flex-wrap:wrap;gap:4px;flex:1}
  .rs-b{
    background:var(--c2);border:2px solid #444;border-radius:8px;
    padding:8px 8px;color:var(--tx);font-size:12px;font-weight:700;
    cursor:pointer;min-width:56px;text-align:center;min-height:42px;
    display:flex;align-items:center;justify-content:center;transition:all .12s
  }
  .rs-b:active{transform:scale(.95)}
  .rs-b.sel{border-color:var(--out);background:rgba(255,51,51,.12);color:var(--out)}

  .act{display:flex;gap:8px;margin-top:6px}
  .undo{
    flex:1;padding:18px;border-radius:10px;border:2px solid #555;
    font-size:18px;font-weight:900;cursor:pointer;background:var(--c2);color:var(--tx);
    min-height:60px;display:flex;align-items:center;justify-content:center
  }
  .undo:active{transform:scale(.97)}
  .undo:disabled{opacity:.3}
  .rec{
    flex:2;padding:18px;border-radius:10px;border:none;
    font-size:20px;font-weight:900;cursor:pointer;
    background:linear-gradient(135deg,var(--red),var(--dk));color:#fff;
    box-shadow:0 4px 15px rgba(196,23,28,.4);letter-spacing:2px;
    min-height:60px;display:flex;align-items:center;justify-content:center
  }
  .rec:active{transform:scale(.97)}

  .log-p{display:flex;flex-direction:column}
  .log-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .log-list{flex:1;overflow-y:auto}
  .le{
    background:var(--c2);border-radius:7px;padding:6px 8px;margin-bottom:3px;
    display:grid;grid-template-columns:28px 44px 1fr 36px;gap:4px;align-items:center;
    font-size:11px;border-left:3px solid transparent;animation:si .2s ease
  }
  @keyframes si{from{opacity:0;transform:translateX(15px)}to{opacity:1;transform:translateX(0)}}
  .le.se{border-left-color:var(--strike)}.le.be{border-left-color:var(--ball)}.le.re{border-left-color:var(--green)}.le.fe{border-left-color:var(--foul)}
  .le-n{font-family:Oswald,sans-serif;font-size:14px;font-weight:700;color:var(--dim)}
  .le-s{font-family:Oswald,sans-serif;font-size:14px;font-weight:700;color:#fff}
  .le-d{display:flex;flex-direction:column;gap:1px}
  .le-pt{font-weight:700;font-size:11px}
  .le-bt{font-size:9px;color:var(--dim)}
  .le-sb{font-family:Oswald,sans-serif;font-size:12px;font-weight:700;text-align:right}
  .le-sb.s{color:var(--strike)}.le-sb.b{color:var(--ball)}.le-sb.f{color:var(--foul)}.le-sb.r{color:var(--green)}

  .sum-btn{background:var(--c2);border:1px solid var(--acc);border-radius:6px;padding:4px 8px;color:var(--acc);font-size:10px;font-weight:700;cursor:pointer}
  .ps{background:var(--c2);border-radius:7px;padding:8px;margin-bottom:6px;border:1px solid #333}
  .ps-n{font-weight:900;font-size:13px;color:var(--acc);margin-bottom:3px}
  .ps-s{display:grid;grid-template-columns:1fr 1fr 1fr;gap:3px;font-size:10px}
  .ps-s span{color:var(--dim)}.ps-s strong{color:#fff}
  .ps-t{font-size:9px;color:var(--dim);margin-top:3px}

  ::-webkit-scrollbar{width:3px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#444;border-radius:2px}
  @media(max-width:900px){.main{grid-template-columns:1fr;height:auto;overflow-y:auto}.pg{grid-template-columns:repeat(3,1fr)}}
</style>
</head>
<body>
<div class="hd">
  <div><div class="hd-t">CARP 2026 ç´…ç™½æˆ¦ æŠ•çƒè¨˜éŒ²</div><div class="hd-d" id="dd"></div></div>
  <div style="font-size:11px;color:rgba(255,255,255,.6)">ANALYST TOOL</div>
</div>
<div class="main">
  <!-- LEFT -->
  <div class="pnl" style="display:flex;flex-direction:column;gap:4px">
    <div>
      <div class="pnl-t">âš¾ æŠ•æ‰‹ï¼ˆæ”¯é…ä¸‹ï¼‰</div>
      <div class="pg" id="pG"></div>
      <div class="pnl-t2">âš¾ æŠ•æ‰‹ï¼ˆè‚²æˆï¼‰</div>
      <div class="pg" id="pGi"></div>
    </div>
    <div style="flex:1;display:flex;flex-direction:column;min-height:0">
      <div class="pnl-t">ğŸ é‡æ‰‹ï¼ˆæ”¯é…ä¸‹ï¼‰</div>
      <div class="pg" id="bG"></div>
      <div class="pnl-t2">ğŸ é‡æ‰‹ï¼ˆè‚²æˆï¼‰</div>
      <div class="pg" id="bGi"></div>
    </div>
  </div>

  <!-- CENTER -->
  <div class="ctr">
    <div class="st">
      <div style="text-align:center"><div class="st-r">Pitcher</div><div class="st-n" id="cP">â€”</div></div>
      <div class="st-v">VS</div>
      <div style="text-align:center"><div class="st-r">Batter</div><div class="st-n" id="cB">â€”</div></div>
    </div>
    <div class="cnt">
      <div class="cnt-stat"><div class="cnt-num" id="pCnt">0</div><div class="cnt-lbl">çƒæ•°</div></div>
      <div class="cnt-g"><div class="cnt-l bl">B</div><div class="cnt-d" id="bD"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>
      <div class="cnt-g"><div class="cnt-l sl">S</div><div class="cnt-d" id="sD"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>
      <div class="cnt-g"><div class="cnt-l ol">O</div><div class="cnt-d" id="oD"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>
      <div class="cnt-stat"><div class="cnt-mx" id="mxS">â€”</div><div class="cnt-lbl">æœ€é€Ÿ</div></div>
      <div class="cnt-stat"><div class="cnt-sp" id="spR">â€”</div><div class="cnt-lbl">S%</div></div>
    </div>
    <div class="inp">
      <div class="irow">
        <div class="ilbl">S/B</div>
        <div class="bso-row" style="flex:1">
          <div class="bso-b str" data-sb="ã‚¹ãƒˆãƒ©ã‚¤ã‚¯" onclick="selSB(this)">ã‚¹ãƒˆãƒ©ã‚¤ã‚¯</div>
          <div class="bso-b bal" data-sb="ãƒœãƒ¼ãƒ«" onclick="selSB(this)">ãƒœãƒ¼ãƒ«</div>
          <div class="bso-b fou" data-sb="ãƒ•ã‚¡ã‚¦ãƒ«" onclick="selSB(this)">ãƒ•ã‚¡ã‚¦ãƒ«</div>
        </div>
      </div>
      <div class="irow">
        <div class="ilbl">çƒé€Ÿ<span class="ilbl-opt">â€»ä»»æ„</span></div>
        <div class="spd-wrap">
          <span class="spd-show" id="spdShow">â€” km</span>
          <div class="spd-numpad">
            <div class="spd-nb" onclick="spdTap('0')">0</div>
            <div class="spd-nb" onclick="spdTap('1')">1</div>
            <div class="spd-nb" onclick="spdTap('2')">2</div>
            <div class="spd-nb" onclick="spdTap('3')">3</div>
            <div class="spd-nb" onclick="spdTap('4')">4</div>
            <div class="spd-nb" onclick="spdTap('5')">5</div>
            <div class="spd-nb" onclick="spdTap('6')">6</div>
            <div class="spd-nb" onclick="spdTap('7')">7</div>
            <div class="spd-nb" onclick="spdTap('8')">8</div>
            <div class="spd-nb" onclick="spdTap('9')">9</div>
            <div class="spd-nb cls" onclick="spdClear()">âœ•</div>
          </div>
        </div>
      </div>
      <div class="irow">
        <div class="ilbl">çƒç¨®<span class="ilbl-opt">â€»ä»»æ„</span></div>
        <div class="pt-grid" id="ptG"></div>
      </div>
      <div class="irow">
        <div class="ilbl">çµæœ<span class="ilbl-opt">â€»ä»»æ„</span></div>
        <div class="rs-grid" id="rsG"></div>
      </div>
      <div class="act">
        <button class="undo" id="undoBtn" onclick="undo()" disabled>â†© æˆ»ã‚‹</button>
        <button class="rec" id="recBtn" onclick="rec()">è¨˜éŒ²</button>
      </div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="pnl log-p">
    <div class="log-h">
      <div class="pnl-t">ğŸ“‹ æŠ•çƒãƒ­ã‚°</div>
      <button class="sum-btn" onclick="showSum()">ğŸ“Š é›†è¨ˆ</button>
    </div>
    <div id="sumA"></div>
    <div class="log-list" id="logL"></div>
  </div>
</div>
<script>
// ===== 2026 FULL ROSTER =====
const pitchers=[
  {no:11,name:'æ–‰è—¤æ±°ç›´'},{no:13,name:'æ£®æµ¦å¤§è¼”'},{no:14,name:'å¤§ç€¬è‰¯å¤§åœ°'},
  {no:16,name:'æ£®ç¿”å¹³'},{no:17,name:'å¸¸å»£ç¾½ä¹Ÿæ–—'},{no:18,name:'æ£®ä¸‹æš¢ä»'},
  {no:19,name:'åºŠç”°å¯›æ¨¹'},{no:20,name:'æ —æ—è‰¯å'},{no:21,name:'ä¸­ï¨‘ç¿”å¤ª'},
  {no:22,name:'é«˜å¤ªä¸€'},{no:24,name:'é»’åŸæ‹“æœª'},{no:26,name:'ç›Šç”°æ­¦å°š'},
  {no:28,name:'ä½è—¤æŸ³ä¹‹ä»‹'},{no:29,name:'ã‚±ãƒ ãƒŠèª '},{no:30,name:'æ»ç”°ä¸€å¸Œ'},
  {no:34,name:'é«˜æ©‹æ˜‚ä¹Ÿ'},{no:35,name:'å·¥è—¤æ³°å·±'},{no:36,name:'å¡¹æ±Ÿæ•¦å“‰'},
  {no:38,name:'èµ¤æœ¨æ™´å“‰'},{no:39,name:'é•·è°·éƒ¨éŠ€æ¬¡'},{no:41,name:'éˆ´æœ¨å¥çŸ¢'},
  {no:42,name:'ã‚¿ãƒ¼ãƒãƒƒã‚¯'},{no:43,name:'å³¶å†…é¢¯å¤ªéƒ'},{no:45,name:'æ¾æœ¬ç«œä¹Ÿ'},
  {no:46,name:'é«˜æœ¨å¿«å¤§'},{no:47,name:'æ–‰è—¤å„ªæ±°'},{no:48,name:'ã‚¢ãƒ‰ã‚¥ãƒ¯èª '},
  {no:53,name:'å²¡æœ¬é§¿'},{no:65,name:'ç‰æ‘æ˜‡æ‚Ÿ'},{no:66,name:'é è—¤æ·³å¿—'},
  {no:67,name:'èŠåœ°ãƒãƒ«ãƒ³'},{no:68,name:'ãƒãƒ¼ãƒ³'},{no:70,name:'æ—¥é«˜æš–å·±'},
  {no:98,name:'è¾»å¤§é›…'},
];
const pitchersIku=[
  {no:120,name:'æ‰ç”°å¥'},{no:123,name:'å°èˆ¹ç¿¼'},{no:126,name:'ç«¹ä¸‹æµ·æ–—'},
  {no:127,name:'æ²³é‡ä½³'},{no:128,name:'æ‰åŸæœ›æ¥'},
];
const batters=[
  {no:'00',name:'ç¾½æœˆéš†å¤ªéƒ'},{no:0,name:'å‹ç”°æˆ'},{no:4,name:'çŸ¢é‡é›…å“‰'},
  {no:5,name:'å°åœ’æµ·æ–—'},{no:7,name:'å ‚æ—ç¿”å¤ª'},{no:9,name:'ç§‹å±±ç¿”å¾'},
  {no:10,name:'ä½ã€…æœ¨æ³°'},{no:27,name:'æœƒæ¾¤ç¿¼'},{no:31,name:'å‚å€‰å°†å¾'},
  {no:32,name:'çŸ³åŸè²´è¦'},{no:33,name:'èŠæ± æ¶¼ä»‹'},{no:37,name:'é‡é–“å³»ç¥¥'},
  {no:44,name:'æ—æ™ƒæ±°'},{no:49,name:'æ¸¡é‚‰æ‚ æ–—'},{no:51,name:'å¹³å·è“®'},
  {no:52,name:'æœ«åŒ…æ˜‡å¤§'},{no:54,name:'è¥¿å·ç¯¤å¤¢'},{no:56,name:'ä¹…ä¿ä¿®'},
  {no:57,name:'æŒä¸¸æ³°è¼'},{no:58,name:'ä»²ç”°ä¾‘ä»'},{no:59,name:'å¤§ç››ç©‚'},
  {no:60,name:'ç”°æ‘ä¿Šä»‹'},{no:61,name:'ãƒ•ã‚¡ãƒ“ã‚¢ãƒ³'},{no:62,name:'æ¸…æ°´å¶äºº'},
  {no:63,name:'å†…ç”°æ¹˜å¤§'},{no:64,name:'é«™æœ¨ç¿”æ–—'},{no:69,name:'è¾°è¦‹é´»ä¹‹ä»‹'},
  {no:93,name:'å‰å·èª å¤ª'},{no:94,name:'ä½è—¤å•“ä»‹'},{no:95,name:'ãƒ¢ãƒ³ãƒ†ãƒ­'},
  {no:96,name:'ä¸­æ‘å¥¨æˆ'},{no:97,name:'ä¸­æ‘è²´æµ©'},{no:99,name:'äºŒä¿£ç¿”ä¸€'},
];
const battersIku=[
  {no:121,name:'ååŸå…¸å½¦'},{no:122,name:'å®‰ç«¹ä¿Šå–œ'},{no:124,name:'å°æ—çµå¤ª'},
  {no:125,name:'å²¸æœ¬å¤§å¸Œ'},{no:131,name:'ãƒ­ãƒ™ãƒ«ãƒˆ'},
];

const pitchTypes=['ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ','ãƒ„ãƒ¼ã‚·ãƒ¼ãƒ ','ã‚«ãƒƒãƒˆ','ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼','ã‚«ãƒ¼ãƒ–','ãƒ•ã‚©ãƒ¼ã‚¯','ãƒã‚§ãƒ³ã‚¸ã‚¢ãƒƒãƒ—','ã‚·ãƒ³ã‚«ãƒ¼','ã‚¹ãƒ—ãƒªãƒƒãƒˆ'];
const resultList=['è¦‹é€ƒã—','ç©ºæŒ¯ã‚Š','ãƒ•ã‚¡ã‚¦ãƒ«','ã‚´ãƒ­','ãƒ•ãƒ©ã‚¤','ãƒ©ã‚¤ãƒŠãƒ¼','ãƒ’ãƒƒãƒˆ','äºŒå¡æ‰“','ä¸‰å¡æ‰“','HR','å››çƒ','æ­»çƒ','çŠ æ‰“','çŠ é£›','ã‚¨ãƒ©ãƒ¼','ä¸‰æŒ¯','ä½µæ®º'];
const atBatEnd=['ã‚´ãƒ­','ãƒ•ãƒ©ã‚¤','ãƒ©ã‚¤ãƒŠãƒ¼','ãƒ’ãƒƒãƒˆ','äºŒå¡æ‰“','ä¸‰å¡æ‰“','HR','å››çƒ','æ­»çƒ','çŠ æ‰“','çŠ é£›','ã‚¨ãƒ©ãƒ¼','ä¸‰æŒ¯','ä½µæ®º'];
const outRes=['ã‚´ãƒ­','ãƒ•ãƒ©ã‚¤','ãƒ©ã‚¤ãƒŠãƒ¼','ä¸‰æŒ¯','çŠ æ‰“','çŠ é£›','ä½µæ®º'];

let S={pitcher:null,batter:null,pt:null,sb:null,result:null,balls:0,strikes:0,outs:0,log:[],pStats:{}};

function init(){
  document.getElementById('dd').textContent=new Date().toLocaleDateString('ja-JP',{year:'numeric',month:'long',day:'numeric',weekday:'short'});
  rGrid('pG',pitchers,'p',false);
  rGrid('pGi',pitchersIku,'p',true);
  rGrid('bG',batters,'b',false);
  rGrid('bGi',battersIku,'b',true);
  rPT();rRS();updCnt();
}
function rGrid(id,arr,t,iku){
  document.getElementById(id).innerHTML=arr.map(p=>`<div class="pb${iku?' iku':''}" data-t="${t}" data-n="${p.name}" onclick="selP('${t}','${p.name}',this)"><span class="n">${p.no}</span>${p.name}</div>`).join('');
}
function rPT(){document.getElementById('ptG').innerHTML=pitchTypes.map(t=>`<div class="pt-b" onclick="selPT('${t}',this)">${t}</div>`).join('')}
function rRS(){document.getElementById('rsG').innerHTML=resultList.map(r=>`<div class="rs-b" onclick="selRS('${r}',this)">${r}</div>`).join('')}

function selP(t,n,el){
  // æŠ•æ‰‹ã¯å…¨æŠ•æ‰‹ãƒœã‚¿ãƒ³ã‹ã‚‰ã€é‡æ‰‹ã¯å…¨é‡æ‰‹ãƒœã‚¿ãƒ³ã‹ã‚‰selã‚’å¤–ã™
  document.querySelectorAll(`.pb[data-t="${t}"]`).forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel');
  if(t==='p'){S.pitcher=n;document.getElementById('cP').textContent=n;updMx();updPC();updSP()}
  else{S.batter=n;document.getElementById('cB').textContent=n}
}
function selSB(el){document.querySelectorAll('.bso-b').forEach(b=>b.classList.remove('sel'));el.classList.add('sel');S.sb=el.dataset.sb}
let spdBuf='';
function spdTap(n){if(spdBuf.length>=2)spdBuf='';spdBuf+=n;updSpdShow()}
function spdClear(){spdBuf='';updSpdShow()}
function updSpdShow(){const el=document.getElementById('spdShow');if(spdBuf.length===2)el.textContent='1'+spdBuf+' km';else if(spdBuf.length===1)el.textContent='1'+spdBuf+'_ km';else el.textContent='â€” km'}
function getSpd(){if(spdBuf.length<2)return null;return parseInt('1'+spdBuf)}
function selPT(t,el){document.querySelectorAll('.pt-b').forEach(b=>b.classList.remove('sel'));el.classList.add('sel');S.pt=t}
function selRS(r,el){
  document.querySelectorAll('.rs-b').forEach(b=>b.classList.remove('sel'));el.classList.add('sel');S.result=r;
  if(r==='è¦‹é€ƒã—'||r==='ç©ºæŒ¯ã‚Š'||r==='ä¸‰æŒ¯')autoSB('ã‚¹ãƒˆãƒ©ã‚¤ã‚¯');
  else if(r==='å››çƒ'||r==='æ­»çƒ')autoSB('ãƒœãƒ¼ãƒ«');
  else if(r==='ãƒ•ã‚¡ã‚¦ãƒ«')autoSB('ãƒ•ã‚¡ã‚¦ãƒ«');
}
function autoSB(sb){document.querySelectorAll('.bso-b').forEach(b=>{b.classList.toggle('sel',b.dataset.sb===sb)});S.sb=sb}

function rec(){
  if(!S.pitcher||!S.batter){flash('æŠ•æ‰‹ã¨æ‰“è€…ã‚’é¸æŠ');return}
  if(!S.sb){flash('S/Bã‚’é¸æŠ');return}
  const speed=getSpd();const pn=S.pitcher;
  if(!S.pStats[pn])S.pStats[pn]={cnt:0,mx:0,sCnt:0,pitches:[]};
  S.pStats[pn].cnt++;
  if(speed&&speed>S.pStats[pn].mx)S.pStats[pn].mx=speed;
  if(S.sb==='ã‚¹ãƒˆãƒ©ã‚¤ã‚¯'||S.sb==='ãƒ•ã‚¡ã‚¦ãƒ«')S.pStats[pn].sCnt++;
  const num=S.pStats[pn].cnt;let pB=S.balls,pS=S.strikes,pO=S.outs;
  if(S.sb==='ã‚¹ãƒˆãƒ©ã‚¤ã‚¯')S.strikes=Math.min(S.strikes+1,3);
  else if(S.sb==='ãƒœãƒ¼ãƒ«')S.balls=Math.min(S.balls+1,4);
  else if(S.sb==='ãƒ•ã‚¡ã‚¦ãƒ«'&&S.strikes<2)S.strikes++;
  const e={pitcher:pn,batter:S.batter,num,speed:speed||null,pt:S.pt||'â€”',sb:S.sb,result:S.result||'â€”',balls:S.balls,strikes:S.strikes,outs:S.outs,pB,pS,pO,ts:new Date().toLocaleTimeString('ja-JP',{hour:'2-digit',minute:'2-digit',second:'2-digit'})};
  const isEnd=S.result&&atBatEnd.includes(S.result);
  if(isEnd){if(outRes.includes(S.result)){S.outs=S.result==='ä½µæ®º'?Math.min(S.outs+2,3):Math.min(S.outs+1,3);e.outs=S.outs}S.balls=0;S.strikes=0}
  S.pStats[pn].pitches.push(e);S.log.push(e);addLog(e,isEnd);updCnt();updMx();updPC();updSP();
  spdBuf='';document.getElementById('spdShow').textContent='â€” km';
  document.querySelectorAll('.pt-b,.bso-b,.rs-b').forEach(b=>b.classList.remove('sel'));
  S.pt=null;S.sb=null;S.result=null;document.getElementById('undoBtn').disabled=false;
}
function flash(m){const b=document.getElementById('recBtn'),o=b.textContent;b.textContent=m;b.style.background='#555';setTimeout(()=>{b.textContent=o;b.style.background=''},1000)}

function addLog(e,isEnd){
  const l=document.getElementById('logL'),d=document.createElement('div');
  let c='le',sc='r';
  if(e.sb==='ã‚¹ãƒˆãƒ©ã‚¤ã‚¯'){c+=' se';sc='s'}else if(e.sb==='ãƒœãƒ¼ãƒ«'){c+=' be';sc='b'}else if(e.sb==='ãƒ•ã‚¡ã‚¦ãƒ«'){c+=' fe';sc='f'}
  if(isEnd)c+=' re';
  const cnt=`${e.balls}-${e.strikes}`,spd=e.speed?e.speed:'â€”',pt=e.pt!=='â€”'?e.pt:'',rs=e.result!=='â€”'?' '+e.result:'';
  d.className=c;
  d.innerHTML=`<div class="le-n">${e.num}</div><div class="le-s">${spd}</div><div class="le-d"><div class="le-pt">${pt}${rs}</div><div class="le-bt">vs${e.batter} [${cnt}]</div></div><div class="le-sb ${sc}">${e.sb==='ã‚¹ãƒˆãƒ©ã‚¤ã‚¯'?'S':e.sb==='ãƒœãƒ¼ãƒ«'?'B':'F'}</div>`;
  l.insertBefore(d,l.firstChild);
}

function undo(){
  if(!S.log.length)return;const last=S.log.pop();const ps=S.pStats[last.pitcher];
  if(ps){ps.cnt--;ps.pitches.pop();ps.mx=ps.pitches.reduce((m,p)=>Math.max(m,p.speed||0),0);if(last.sb==='ã‚¹ãƒˆãƒ©ã‚¤ã‚¯'||last.sb==='ãƒ•ã‚¡ã‚¦ãƒ«')ps.sCnt--}
  S.balls=last.pB;S.strikes=last.pS;S.outs=last.pO;
  const l=document.getElementById('logL');if(l.firstChild)l.removeChild(l.firstChild);
  updCnt();updMx();updPC();updSP();if(!S.log.length)document.getElementById('undoBtn').disabled=true;
}

function updCnt(){
  const bd=document.getElementById('bD').children,sd=document.getElementById('sD').children,od=document.getElementById('oD').children;
  for(let i=0;i<4;i++)bd[i].className='dot'+(i<S.balls?' ba':'');
  for(let i=0;i<3;i++)sd[i].className='dot'+(i<S.strikes?' sa':'');
  for(let i=0;i<3;i++)od[i].className='dot'+(i<S.outs?' oa':'');
}
function updMx(){const el=document.getElementById('mxS');if(S.pitcher&&S.pStats[S.pitcher]){const m=S.pStats[S.pitcher].mx;el.textContent=m>0?m+'':'â€”'}else el.textContent='â€”'}
function updPC(){const el=document.getElementById('pCnt');if(S.pitcher&&S.pStats[S.pitcher])el.textContent=S.pStats[S.pitcher].cnt;else el.textContent='0'}
function updSP(){const el=document.getElementById('spR');if(S.pitcher&&S.pStats[S.pitcher]){const ps=S.pStats[S.pitcher];if(ps.cnt>0)el.textContent=Math.round(ps.sCnt/ps.cnt*100)+'%';else el.textContent='â€”'}else el.textContent='â€”'}

function showSum(){
  const a=document.getElementById('sumA');if(a.innerHTML){a.innerHTML='';return}let h='';
  for(const[n,s]of Object.entries(S.pStats)){
    if(!s.cnt)continue;const types={};s.pitches.forEach(p=>{if(p.pt!=='â€”')types[p.pt]=(types[p.pt]||0)+1});
    const ts=Object.entries(types).map(([t,c])=>`${t}:${c}`).join(' ');
    const sr=s.cnt>0?Math.round(s.sCnt/s.cnt*100):0;
    h+=`<div class="ps"><div class="ps-n">${n}</div><div class="ps-s"><div><span>çƒæ•°:</span><strong>${s.cnt}</strong></div><div><span>æœ€é€Ÿ:</span><strong>${s.mx>0?s.mx+'km':'â€”'}</strong></div><div><span>S%:</span><strong>${sr}%</strong></div></div>${ts?`<div class="ps-t">${ts}</div>`:''}</div>`;
  }
  if(!h)h='<div style="text-align:center;color:#888;padding:10px;font-size:11px">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';a.innerHTML=h;
}
init();
</script>
</body>
</html>
